---
- name: Install and configure nodes
  hosts: raspi
  gather_facts: true
  become: true
  vars_files:
    - ../vars/main.yml
    - ../vars/raspi.yml
  tasks:
    - ansible.builtin.include_role:
        name: ../roles/hardening
    - ansible.builtin.include_role:
        name: ../roles/bash
    - ansible.builtin.include_role:
        name: ../roles/filesystem
    - ansible.builtin.include_role:
        name: ../roles/packages
        tasks_from: main
    - ansible.builtin.include_role:
        name: ../roles/packages
        tasks_from: raspi
    - ansible.builtin.include_role:
        name: ../roles/taskfile-dev
    - ansible.builtin.include_role:
        name: ../roles/git
    - ansible.builtin.include_role:
        name: ../roles/docker
        tasks_from: main
    - ansible.builtin.include_role:
        name: ../roles/cron
        tasks_from: main

- name: Install and configure nodes (non-root)
  hosts: raspi
  gather_facts: true
  become: false
  vars_files:
    - ../vars/main.yml
    - ../vars/raspi.yml
  tasks:
    - ansible.builtin.include_role:
        name: ../roles/atuin

- name: Install and configure admin-pi specifics
  hosts: admin-pi.fritz.box
  gather_facts: true
  become: true
  vars_files:
    - ../vars/main.yml
    - ../vars/raspi.yml
  tasks:
    - ansible.builtin.include_role:
        name: ../roles/ansible

- name: Install and configure runner-04-pi specifics (non-root)
  hosts: runner-04-pi.fritz.box
  gather_facts: true
  become: false
  vars_files:
    - ../vars/main.yml
  tasks:
    - ansible.builtin.include_role:
        name: ../roles/services
        tasks_from: petclinic
