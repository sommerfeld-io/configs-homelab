---
- name: Install and configure nodes
  hosts: ubuntu_desktop
  gather_facts: true
  become: true
  vars_files:
    - ../vars/global.yml
    - ../vars/ubuntu.yml
  tasks:

    - ansible.builtin.include_role:
        name: ../roles/hardening

    - ansible.builtin.include_role:
        name: ../roles/bash

    - ansible.builtin.include_role:
        name: ../roles/filesystem

    - ansible.builtin.include_role:
        name: ../roles/git

    - ansible.builtin.include_role:
        name: ../roles/packages
        tasks_from: main

    - ansible.builtin.include_role:
        name: ../roles/packages
        tasks_from: ubuntu

    - ansible.builtin.include_role:
        name: ../roles/docker
        tasks_from: main

    - ansible.builtin.include_role:
        name: ../roles/vscode
        tasks_from: main

    - ansible.builtin.include_role:
        name: ../roles/cron
        tasks_from: main

    - ansible.builtin.include_role:
        name: ../roles/taskfile-dev

    - ansible.builtin.include_role:
        name: ../roles/ansible

    - ansible.builtin.include_role:
        name: ../roles/conky

    - ansible.builtin.include_role:
        name: ../roles/github-cli

    - ansible.builtin.include_role:
        name: ../roles/virtualization

- name: Install and configure nodes (non-root)
  hosts: ubuntu_desktop
  gather_facts: true
  become: false
  vars_files:
    - ../vars/global.yml
    - ../vars/ubuntu.yml
  tasks:

    - ansible.builtin.include_role:
        name: ../roles/atuin

    - ansible.builtin.include_role:
        name: ../roles/cron
        tasks_from: jobs

    - ansible.builtin.include_role:
        name: ../roles/docker
        tasks_from: scout

    - ansible.builtin.include_role:
        name: ../roles/vscode
        tasks_from: plugins
