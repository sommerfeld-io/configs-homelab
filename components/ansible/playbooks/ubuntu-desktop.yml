---
- name: Install and configure nodes
  hosts: ubuntu_desktop
  gather_facts: true
  become: true
  vars_files:
    - ../vars/global.yml
    - ../vars/ubuntu.yml
  tasks:

    - ansible.builtin.include_role:
        name: ../roles/hardening
        tasks_from: main

    - ansible.builtin.include_role:
        name: ../roles/bash

    - ansible.builtin.include_role:
        name: ../roles/filesystem

    - ansible.builtin.include_role:
        name: ../roles/git

    - ansible.builtin.import_tasks: ../tasks/common-packages.yml
    - ansible.builtin.import_tasks: ../tasks/common-cron-config.yml

    - ansible.builtin.include_role:
        name: ../roles/taskfile-dev

    - ansible.builtin.include_role:
        name: ../roles/ansible

    - ansible.builtin.import_tasks: ../tasks/ubuntu-packages.yml

    - ansible.builtin.include_role:
        name: ../roles/conky

    - ansible.builtin.import_tasks: ../tasks/ubuntu-chrome.yml
    - ansible.builtin.import_tasks: ../tasks/ubuntu-media-players.yml
    - ansible.builtin.import_tasks: ../tasks/ubuntu-sublime.yml

    - ansible.builtin.include_role:
        name: ../roles/github-cli

    - ansible.builtin.include_role:
        name: ../roles/virtualization

    - ansible.builtin.import_tasks: ../tasks/ubuntu-docker.yml
    - ansible.builtin.import_tasks: ../tasks/common-uninstall.yml
    - ansible.builtin.import_tasks: ../tasks/ubuntu-uninstall.yml

- name: Install and configure nodes (non-root)
  hosts: ubuntu_desktop
  gather_facts: true
  become: false
  vars_files:
    - ../vars/global.yml
    - ../vars/ubuntu.yml
  tasks:

    - ansible.builtin.include_role:
        name: ../roles/atuin
    - ansible.builtin.import_tasks: ../tasks/common-cron-jobs.yml
    - ansible.builtin.import_tasks: ../tasks/ubuntu-docker-scout.yml
    - ansible.builtin.import_tasks: ../tasks/ubuntu-vscode-plugins.yml
